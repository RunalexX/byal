<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>SÄ±nÄ±f Arama Sistemi</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
  <style>
    body { font-family: Arial; padding: 20px; background: #f9f9f9; }
    input, button { margin: 5px; padding: 8px; }
    #results { margin-top: 20px; white-space: pre-wrap; background:#fff; padding:10px; border:1px solid #ccc; }
  </style>
</head>
<body>
  <h2>SÄ±nÄ±f Listesi Arama</h2>
  <p>Ad Soyad veya sÄ±nÄ±f adÄ± yaz â†’ Sorgula</p>
  <input type="text" id="query" placeholder="Ã¶rn: Ahmet YÄ±lmaz veya 11A">
  <button onclick="search()">Ara</button>

  <div id="results">SorgulanÄ±yor...</div>

  <script>
    let pdfText = "";

    // Repo kÃ¶kÃ¼nde duran PDF dosyan
    const pdfUrl = "5500.pdf";

    // PDF'ten metin Ã§ek
    async function loadPdf() {
      try {
        const pdf = await pdfjsLib.getDocument(pdfUrl).promise;
        let text = "";
        for (let i = 1; i <= pdf.numPages; i++) {
          const page = await pdf.getPage(i);
          const content = await page.getTextContent();
          text += content.items.map(it => it.str).join(" ") + "\n";
        }
        pdfText = text;
        document.getElementById("results").innerText = "SorgulanÄ±yor... âœ… Arama yapabilirsiniz.";
      } catch (err) {
        document.getElementById("results").innerText = "PDF yÃ¼klenemedi âŒ " + err.message;
      }
    }
    loadPdf();

    // Arama
    function search() {
      const q = document.getElementById("query").value.trim().toLowerCase();
      if (!q || !pdfText) {
        alert("PDF henÃ¼z yÃ¼klenmedi veya arama boÅŸ!");
        return;
      }

      const lines = pdfText.split(/\r?\n/).map(l => l.trim()).filter(Boolean);
      let results = [];

      // EÄŸer giriÅŸ "10A", "11B", "12C" gibi bir sÄ±nÄ±f adÄ±ysa
      const classMatch = q.match(/^\\d{1,2}[a-zÃ§ÄŸÄ±Ã¶ÅŸÃ¼]$/i);
      if (classMatch) {
        let capture = false;
        for (const line of lines) {
          const lower = line.toLowerCase();
          if (lower.includes(q)) {
            capture = true; // sÄ±nÄ±f bulundu, Ã¶ÄŸrencileri yakalamaya baÅŸla
            results.push("ğŸ“Œ " + line);
            continue;
          }
          if (capture) {
            // EÄŸer yeni bir sÄ±nÄ±f baÅŸlÄ±ÄŸÄ±na geldiysek dur
            if (/^\\d{1,2}[a-zÃ§ÄŸÄ±Ã¶ÅŸÃ¼]/i.test(line)) break;
            results.push(line);
          }
        }
      } else {
        // Normal ad/soyad aramasÄ±
        for (const line of lines) {
          if (line.toLowerCase().includes(q)) {
            results.push(line);
          }
        }
      }

      document.getElementById("results").innerText = results.length
        ? results.join("\\n")
        : "SonuÃ§ bulunamadÄ±.";
    }
  </script>
</body>
</html>
